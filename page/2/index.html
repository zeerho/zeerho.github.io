<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.0.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.0.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.0.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.0.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.0.0" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="Just a repo for documents">
<meta property="og:type" content="website">
<meta property="og:title" content="Tags">
<meta property="og:url" content="http://yoursite.com/tags/index.html">
<meta property="og:site_name" content="zeerho">
<meta property="og:description" content="Just a repo for documents">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-06-05T02:37:10.245Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Tags">
<meta name="twitter:description" content="Just a repo for documents">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.0.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/tags/"/>





  <title>zeerho</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">zeerho</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/18/工具/vscode/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zeerho">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zeerho">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/18/工具/vscode/" itemprop="url">vscode</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-18T13:56:00+08:00">2018-12-18</time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="快捷键"><a href="#快捷键" class="headerlink" title="快捷键"></a>快捷键</h1><p><em>转自 <a href="https://blog.csdn.net/crper/article/details/54099319" target="_blank" rel="noopener"></a></em></p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/12/18/工具/vscode/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/14/Javascript/Node-js/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zeerho">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zeerho">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/14/Javascript/Node-js/" itemprop="url">Node-js</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-14T14:02:00+08:00">2018-12-14</time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="模块化"><a href="#模块化" class="headerlink" title="模块化"></a>模块化</h1><h2 id="使用简介"><a href="#使用简介" class="headerlink" title="使用简介"></a>使用简介</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 文件名 hello-there.js</span></span><br><span class="line"><span class="comment">// 在模块中暴露方法、变量</span></span><br><span class="line">exports.hello = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"hello!"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在另一个文件中引入模块</span></span><br><span class="line"><span class="comment">// 这里拿到的就是指定模块的 `exports` 对象</span></span><br><span class="line"><span class="keyword">var</span> helloThere = <span class="built_in">require</span>(<span class="string">"./maybe-paths-here/hello-there"</span>);</span><br><span class="line">helloThere.hello();</span><br></pre></td></tr></table></figure>
<h2 id="npm"><a href="#npm" class="headerlink" title="npm"></a>npm</h2><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><ul>
<li><code>npm -v</code></li>
<li><code>npm init [--yes]</code>：初始化一个 <code>package.json</code>；<code>--yes</code> 使用默认配置。<ul>
<li><code>name</code>：模块名，要求：<ul>
<li>全部小写</li>
<li>没有空格</li>
<li>允许破折号和下划线</li>
</ul>
</li>
<li><code>description</code>：若为空会从当前目录下的 <code>README.MD</code> 或 <code>README</code> 读取第一行作为内容</li>
<li><code>scripts</code>：常用命令</li>
</ul>
</li>
<li><code>npm install {package_name} [--save|save-dev]</code>：安装指定包到当前目录下的 <code>node_modules</code> 目录。<code>--save|save-dev</code> 安装包的同时更新 <code>package.json</code>，分别对应生产环境和开发环境。<ul>
<li><code>npm install npm@latest -g</code>：单独更新 npm。<code>-g</code> 表示全局模块。</li>
</ul>
</li>
<li><code>npm uninstall {package_name} [--save]</code>：卸载模块。<code>--save</code> 卸载的同时也从 <code>package.json</code> 中删除。</li>
<li><code>npm ls [--depth=0]</code> 查看依赖情况。</li>
<li><code>npm outdated [-g] [--depth=0]</code>：查看过期包。</li>
<li><code>npm update [-g] [{package_name}]</code>：更新模块。</li>
<li><code>npm search {keyWord}</code>: 搜索模块名字和描述。</li>
</ul>
<h3 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">dadada</span><br></pre></td></tr></table></figure>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><ul>
<li><code>npm config set {key} {val} [-g]</code> 或 <code>npm set {key} [-g]</code>：用户级别配置。<code>-g</code> 系统级别（$prefix/npmrc）。</li>
<li><code>npm config get {key}</code> 或 <code>npm get {key}</code></li>
<li><code>npm config delete {key}</code></li>
<li><code>npm config list [-l] [--json]</code></li>
</ul>
<p><strong>配置加载顺序</strong></p>
<ol>
<li>命令行参数</li>
<li>环境变量</li>
<li>npmrc<ol>
<li>项目级别：/myProj/.npmrc</li>
<li>用户级别：~/.npmrc</li>
<li>全局级别：$PREFIX/etc/npmrc</li>
<li>npm 内置：/pathToNpm/npmrc</li>
</ol>
</li>
</ol>
<p><strong>配置源</strong></p>
<ul>
<li><code>npm install {pkg} --registry {url}</code>：安装包的时候临时使用。</li>
<li><code>npm config set registry {url}</code>：用户级别。<ul>
<li><code>npm config get registry</code> 或 <code>npm info {pkg}</code>：验证是否配置成功。</li>
</ul>
</li>
<li>使用 cnpm：<ul>
<li><code>npm install -g cnpm --registry={url}</code>：安装 cnpm。</li>
<li><code>cnpm install {pkg}</code>：使用 cnpm 安装包。</li>
</ul>
</li>
</ul>
<h2 id="使用模块"><a href="#使用模块" class="headerlink" title="使用模块"></a>使用模块</h2><h3 id="查找模块"><a href="#查找模块" class="headerlink" title="查找模块"></a>查找模块</h3><ol>
<li>内置模块。</li>
<li>若模块名以路径开始（<code>./</code>、<code>../</code>、<code>/</code>），则在指定路径搜索。<ol>
<li>若指定了 <code>.js</code> 扩展名，则直接加载该文件。</li>
<li>否则查找基于同名文件夹的模块。</li>
<li>若没有，则添加扩展名 <code>.js</code>、<code>.json</code>、<code>.node</code>，依次尝试加载。（<code>.node</code> 会被编译成附加模块）</li>
</ol>
</li>
<li>若模块名不是以路径开始，则在 <code>./node_modules</code> 下查找。</li>
<li>若没有，则以 Node 自己的方式在当前位置的目录树下搜索 <code>node_modules</code> 文件夹。</li>
<li>若没有，则在一些默认路径下搜索，如 <code>/usr/lib</code>、<code>/usr/local/lib</code>。</li>
<li>若没有，抛出错误。</li>
</ol>
<h3 id="循环引用"><a href="#循环引用" class="headerlink" title="循环引用"></a>循环引用</h3><p>发生循环引用时，Node 先简单地返回一个尚未完成初始化的对象到引用处。在所有引用处都拿到对象之后再依次进行对象初始化。</p>
<h2 id="编写模块"><a href="#编写模块" class="headerlink" title="编写模块"></a>编写模块</h2><ol>
<li>创建一个文件夹来存放模块内容。</li>
<li>添加 <code>package.json</code> 文件。其中至少包含当前模块名称和一个主要 js 文件（作为加载入口）。</li>
<li>若未找到 <code>package.json</code> 或没指定主要 js 文件，则会查找 <code>index.js</code> 或编译后的附加模块 <code>index.node</code>。</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/15/数据库/oracle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zeerho">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zeerho">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/15/数据库/oracle/" itemprop="url">oracle</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-15T09:00:00+08:00">2018-11-15</time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="TNS-介绍"><a href="#TNS-介绍" class="headerlink" title="TNS 介绍"></a>TNS 介绍</h1><p>Transparence Network Substrate 透明网络底层。</p>
<p>TNS 是用来管理 oracle 服务端和客户端连接的一个工具。大部分情况下客户端连接服务端都要配置 TNS（少部分情况比如通过 JDBC 连接）。要通过 TNS 连接服务端，客户端必须安装 Oracle Client。</p>
<p>TNS 配置文件分为服务端和客户端：</p>
<ul>
<li>服务端：listener.ora、sqlnet.ora、tnsnames.ora 等。</li>
<li>客户端：sqlnet.ora、tnsnames.ora。</li>
</ul>
<p>默认在 <code>$ORACLE_HOME/network/admin/</code> 下。</p>
<ul>
<li>listener.ora: 配置服务端的监听器，用来监听客户端的连接请求。默认是 1521 端口。</li>
<li>sqlnet.ora: 管理和约束 TNS 连接的配置。</li>
<li>tnsnames.ora: 配置连接。</li>
</ul>
<h2 id="listener-ora"><a href="#listener-ora" class="headerlink" title="listener.ora"></a>listener.ora</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">LISTENER = </span><br><span class="line">  (DESCRIPTION_LIST =</span><br><span class="line">    (DESCRIPTION = </span><br><span class="line">      (ADDRESS = (PROTOCOL = TCP)(HOST = &#123;host&#125;)(PORT = 1521))</span><br><span class="line">      (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1521))</span><br><span class="line">    )</span><br><span class="line">  )</span><br></pre></td></tr></table></figure>
<p>这里没列出 <code>SID_LIST_LISTENER</code> 部分，因为从 9i 开始引入了动态监听服务注册，数据库启动时会自动注册实例到监听列表。</p>
<h2 id="tnsnames-ora"><a href="#tnsnames-ora" class="headerlink" title="tnsnames.ora"></a>tnsnames.ora</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;tnsName&#125; =</span><br><span class="line">  (DESCRIPTION =</span><br><span class="line">    (ADDRESS_LIST =</span><br><span class="line">      (ADDRESS = (PROTOCOL = &#123;protocol&#125;)(HOST = &#123;host&#125;)(PORT = &#123;port&#125;))</span><br><span class="line">    )</span><br><span class="line">    (CONNECT_DATA =</span><br><span class="line">      (SERVICE_NAME = &#123;serviceName&#125;)</span><br><span class="line">    )</span><br><span class="line">  )</span><br></pre></td></tr></table></figure>
<ul>
<li>{tnsName}: TNS 名。</li>
<li><code>DESCRIPTION</code>: 服务端的监听地址信息。<ul>
<li>{protocol}: 一般是 tcp。</li>
<li>{host}: 服务端 ip。在局域网内也可以用计算机名。</li>
<li>{port}: 默认 1521。</li>
</ul>
</li>
<li><code>CONNECT_DATA</code>: 要连接的数据以及连接方式（专用或共享）。</li>
</ul>
<h1 id="sqlplus-登录的-4-种方式"><a href="#sqlplus-登录的-4-种方式" class="headerlink" title="sqlplus 登录的 4 种方式"></a>sqlplus 登录的 4 种方式</h1><ol>
<li><code>sqlplus / as sysdba</code><br>操作系统认证，不需要数据库服务器启动 listener，也不需要数据库服务器处于可用状态。比如想要启动数据库就可以用这种方式进入 sqlplus，然后通过 <code>startup</code> 命令来启动。</li>
<li><code>sqlplus {username}/{password}</code><br>连接本机数据库，不需要数据库服务器的 listener 进程，但是由于需要用户名密码的认证，因此需要数据库服务器处于可用状态。</li>
<li><code>sqlplus {username}/{password}@{host}/{instanceName} [as sysdba]</code><br>通过网络连接，这时需要数据库服务器的 listener 处于监听状态。<code>as sysdba</code> 表示作为 dba 登录。也可以用 tnsname 代替 <code>{host}/{instanceName}</code>。此时建立一个连接的大致步骤如下：<ol>
<li>查询 sqlnet.ora，看看名称的解析方式，默认是 TNSNAME。</li>
<li>查询 tnsnames.ora 文件，找到具体的连接方式。</li>
<li>如果服务器 listener 进程没有问题的话，建立与 listener 进程的连接。</li>
<li>根据不同的服务器模式如专用服务器模式或者共享服务器模式，listener 采取接下去的动作。默认是专用服务器模式，没有问题的话客户端就连接上了数据库的服务端进程。</li>
</ol>
</li>
<li><code>sqlplus /nolog</code> <code>conn {username}/{password}[@{host}/{instanceName}</code> 依次执行两条命令，这样创建的进程是不带用户名密码的。</li>
</ol>
<h1 id="客户端安装配置"><a href="#客户端安装配置" class="headerlink" title="客户端安装配置"></a>客户端安装配置</h1><ol>
<li>(windows)添加环境变量 <code>TNS_ADMIN</code>，值为 tnsnames.ora 文件所在路径。如果安装了 ORACLE 并且设置了 <code>ORACLE_HOME</code> 环境变量，那么会自动在 <code>%ORACLE_HOME%/network/admin/</code> 下查找 tnsnames.ora 文件。</li>
<li>(linux)添加环境变量 <code>LD_LIBRARY_PATH=/opt/oracle/instantclient_18_3:$LD_LIBRARY_PATH</code> 动态链接库。</li>
<li>添加环境变量 <code>NLS_LANG = SIMPLIFIED CHINESE_CHINA.ZHS16GBK</code> （<code>AMERICAN_AMERICA.US7ASCII</code> 是 ASCII 编码类型）</li>
<li>配置 plsql: tools - preferences - connection <ul>
<li>Oracle Home=$oracleclient</li>
<li>OCI library=$oracleclient\oci.dll  </li>
</ul>
</li>
</ol>
<h1 id="查看版本信息"><a href="#查看版本信息" class="headerlink" title="查看版本信息"></a>查看版本信息</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> v$<span class="keyword">version</span>;</span><br></pre></td></tr></table></figure>
<h1 id="ACID"><a href="#ACID" class="headerlink" title="ACID"></a>ACID</h1><h2 id="原子性（Atomicity）"><a href="#原子性（Atomicity）" class="headerlink" title="原子性（Atomicity）"></a>原子性（Atomicity）</h2><p>事务中的所有操作要么全部执行要么全部不执行。</p>
<ol>
<li>一致性（Consistency）</li>
</ol>
<p>事务执行成功后会改变数据库的状态，一致性指的是不同客户端在同一时刻看到的状态是否一致。</p>
<ul>
<li>强一致性：读操作可以立即读到提交的更新操作。</li>
<li>弱一致性：提交的更新操作不一定立即会被读操作读到，此时存在一个不一致窗口。</li>
<li>最终一致性：弱一致性的特例。事务更新一份数据，最终一致性保证在没有其他事务更新同样的值的话，最终所有的事务都会读到之前事务更新的最新值。如果没有错误发生，不一致窗口的大小依赖于：通信延迟，系统负载等。</li>
<li>单调一致性：如果一个进程已经读到一个值，那么后续不会读到更早的值。</li>
<li>会话一致性：保证同一个会话中，读操作可以读到更新操作后的最新值。</li>
</ul>
<ol>
<li>隔离性（Isolation）</li>
</ol>
<p>事务之间互相影响的程度。</p>
<ul>
<li>脏读：事务 A 修改了一个数据，未提交。事务 B 读到了事务 A 未提交的更新结果。如果事务 A 提交失败，事务 B 读到的就是脏数据。</li>
<li>不可重复读：同一事务中，对于同一份数据读取到的结果不一致。比如，事务 B 在事务 A 提交前读到的结果，和提交后读到的结果可能不同。不可重复读出现的原因就是事务并发修改记录，要避免这种情况，最简单的方法就是对要修改的记录加锁，这会导致锁竞争加剧，影响性能。另一种方法是使用 MVCC 可以在无锁的情况下避免不可重复读。</li>
<li>幻读：在同一个事务中，同一个查询多次返回的结果不一致。事务 A 新增了一条记录，事务 B 在事务 A 提交前后各执行了一次查询操作，发现后一次比前一次多了一条记录。幻读是由于并发事务增加记录导致的，这个不能像不可重复读通过记录加锁解决，因为对于新增的记录根本无法加锁。需要将事务串行化，才能避免幻读。</li>
</ul>
<p>事务的隔离级别从低到高有：</p>
<ul>
<li>Read Uncommitted：最低的隔离级别，什么都不需要做，一个事务可以读到另一个事务未提交的结果。所有的并发事务问题都会发生。</li>
<li>Read Committed：只有在事务提交后，其更新结果才会被其他事务看见。可以解决脏读问题。</li>
<li>Repeated Read：在一个事务中，对于同一份数据的读取结果总是相同的，无论是否有其他事务对这份数据进行操作，以及这个事务是否提交。可以解决脏读、不可重复读。</li>
<li>Serialization：事务串行化执行，隔离级别最高，牺牲了系统的并发性。可以解决并发事务的所有问题。</li>
</ul>
<ol>
<li>持久性（Durability）</li>
</ol>
<p>数据持久化。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/16/工具/Gradle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zeerho">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zeerho">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/16/工具/Gradle/" itemprop="url">Gradle</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-16T09:00:00+08:00">2018-08-16</time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h1><h2 id="gradle-wrapper"><a href="#gradle-wrapper" class="headerlink" title="gradle wrapper"></a>gradle wrapper</h2><p>项目刚创建时为它生成 gradle wrapper 相关文件。在项目根目录下执行：</p>
<ul>
<li><code>gradle wrapper [-options]</code><ul>
<li><code>--gradle-version {m.n}</code> 指定本项目的 gradle 版本。</li>
<li><code>--gradle-distribution-url</code> 指定下载 gradle 的地址。</li>
</ul>
</li>
</ul>
<p>以后使用 <code>gradlew</code> 执行任务就会使用项目指定的版本而不是系统变量中指定的版本。</p>
<p>要更新项目的 gradle wrapper 版本的话，先更新系统里安装的 gradle，然后再执行一次 <code>gradle wrapper</code> 任务。但一般不用更新 gradle wrapper。</p>
<p><strong><code>gradle-wrapper.properties</code> 中的属性</strong></p>
<ul>
<li><code>distributionBase</code> 存放 gradle 包的主目录。</li>
<li><code>distributionPath</code> 实际存放 gradle 包的目录，是相对于 <code>distributionBase</code> 的相对路径。</li>
<li><code>zipStoreBase</code> 类似 <code>distributionBase</code>，用于压缩包。</li>
<li><code>zipStorePath</code> 类似 <code>distributionPath</code>，用于压缩包。</li>
<li><code>distributionUrl</code> 压缩包的下载地址（冒号要加反斜杠）。</li>
</ul>
<h2 id="gradle-命令"><a href="#gradle-命令" class="headerlink" title="gradle 命令"></a>gradle 命令</h2><p><code>gradle {taskName} [options]</code></p>
<ul>
<li><code>-i</code>: 改变日志级别为 INFO</li>
<li><code>-s</code>: 如果运行时错误发生打印堆栈信息</li>
<li><code>-q</code>: 只打印错误信息</li>
<li><code>-?</code>,<code>-h</code>,<code>--help</code>: 打印所有的命令行选项</li>
<li><code>-b</code>,<code>--build-file</code>: 执行其他脚本（默认是 build.gradle）</li>
<li><code>--offline</code>: 在离线模式运行，只检查本地缓存中的依赖</li>
<li><code>-D</code>,<code>--system-prop</code>: Gradle 作为 JVM 进程运行，可以提供一个系统属性，比如：-Dmyprop=myValue</li>
<li><code>-P</code>,<code>--project-prop</code>: 传递一个属性值给 build 脚本，比如：-Pmyprop=myValue</li>
<li><code>-x</code>: 排除指定的任务</li>
</ul>
<p>自带的命令：</p>
<ul>
<li><code>tasks</code>: 显示所有可运行的任务。</li>
<li><code>properties</code>: 显示项目中所有属性。</li>
</ul>
<h1 id="常用配置"><a href="#常用配置" class="headerlink" title="常用配置"></a>常用配置</h1><h2 id="build-gradle"><a href="#build-gradle" class="headerlink" title="build.gradle"></a>build.gradle</h2><p>配置脚本中的方法一般都在 gradle 项目各子模块的 <code>org.gradle.api</code> 包下。相应的实现一般在对应的 <code>org.gradle.api.internal</code> 及其子包下。</p>
<p>一个 <code>build.gradle</code> 相当于一个 <code>Project</code> 对象。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">allprojects &#123;</span><br><span class="line">  repositories &#123;</span><br><span class="line">    maven &#123;</span><br><span class="line">      url <span class="string">'&#123;url&#125;'</span></span><br><span class="line">      mavenLocal()</span><br><span class="line">      <span class="comment">// 换成国内镜像，这段可以放在 .gradle/init.gradle 中，实现全局效果</span></span><br><span class="line">      url <span class="string">'http://maven.aliyun.com/nexus/content/repositories/central/'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//----------------------------------------</span></span><br><span class="line"><span class="comment">// 这个任务可以放在 $GRADLE_USER_HOME/init.gradle 中，从而自定义 gradle wrapper</span></span><br><span class="line">task wrapper(<span class="string">type:</span> Wrapper) &#123;</span><br><span class="line">  gradleVersion = <span class="string">'1.2'</span></span><br><span class="line">  distributionUrl = <span class="string">'http://myenterprise.com/gradle/dists'</span></span><br><span class="line">  distributionPath = <span class="string">'gradle-dists'</span>         </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个任务</span></span><br><span class="line"><span class="comment">// 这里 myTask 和闭包都是 `Project#task()` 的参数，</span></span><br><span class="line"><span class="comment">// 只不过经 gradle 通过 AST 转换而成了特殊的语法。</span></span><br><span class="line">task myTask &#123;</span><br><span class="line">  <span class="comment">// codes here</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//----------------------------------------</span></span><br><span class="line"><span class="comment">// java 项目用到的插件</span></span><br><span class="line">apply <span class="string">plugin:</span> <span class="string">'java'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//----------------------------------------</span></span><br><span class="line"><span class="comment">// 上传至 maven 仓库</span></span><br><span class="line">apply <span class="string">plugin:</span> <span class="string">'maven'</span></span><br><span class="line"></span><br><span class="line">uploadArchives &#123;</span><br><span class="line">  repositories.mavenDeployer &#123;</span><br><span class="line">    repository(<span class="string">url:</span> <span class="string">"http://localhost:8088/nexus/content/repositories/snapshots/"</span>) &#123;</span><br><span class="line">      authentication(<span class="string">userName:</span> <span class="string">"admin"</span>, <span class="string">password:</span> <span class="string">"admin123"</span>)</span><br><span class="line">        pom.groupId = <span class="string">"com.example"</span></span><br><span class="line">        pom.artifactId = <span class="string">"my-example"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//----------------------------------------</span></span><br><span class="line"><span class="comment">// 默认文件结构跟 maven 一样，也可以自定义</span></span><br><span class="line">sourceSets &#123;</span><br><span class="line">  main &#123;</span><br><span class="line">    java &#123;</span><br><span class="line">      srcDir <span class="string">'src/java'</span></span><br><span class="line">    &#125;</span><br><span class="line">    resources &#123;</span><br><span class="line">      srcDir <span class="string">'src/resources'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="gradle-properties"><a href="#gradle-properties" class="headerlink" title="gradle.properties"></a>gradle.properties</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> # 代理</span><br><span class="line">systemProp.http.proxyHost=1.2.3.4</span><br><span class="line">systemProp.http.proxyPort=8002</span><br><span class="line">systemProp.http.proxyUser=tom</span><br><span class="line">systemProp.http.proxyPassword=1234</span><br><span class="line">systemProp.http.nonProxyHosts=1.2.*.*|localhost</span><br><span class="line"></span><br><span class="line">systemProp.https.proxyHost=1.2.3.4</span><br><span class="line">systemProp.https.proxyPort=8002</span><br><span class="line">systemProp.https.proxyUser=tom</span><br><span class="line">systemProp.https.proxyPassword=1234</span><br><span class="line">systemProp.https.nonProxyHosts=1.2.*.*|localhost</span><br></pre></td></tr></table></figure>
<h1 id="AST-转换"><a href="#AST-转换" class="headerlink" title="AST 转换"></a>AST 转换</h1><p>Abstract Syntax Tree</p>
<p>Gradle 中的特殊语法都是通过 AST 转换实现的。将脚本代码贴至 groovyConsole 中然后按 <code>ctrl+t</code> 可看到实际的 AST。</p>
<p>见 <code>org.gradle.groovy.scripts.internal.TaskDefinitionScriptTransformer</code> 和 <code>org.gradle.groovy.scripts.internal.AstUtils</code>。</p>
<h1 id="基本元素"><a href="#基本元素" class="headerlink" title="基本元素"></a>基本元素</h1><h2 id="Script"><a href="#Script" class="headerlink" title="Script"></a>Script</h2><p><code>Script</code> 脚本用来定义一个 <code>Project</code>。</p>
<p><strong>Init Script</strong></p>
<p>每次构建之前都会执行初始化脚本，用来设置一些全局变量。存放初始化脚本的位置包括：</p>
<ul>
<li>$USER/.gradle/</li>
<li>$USER/.gradle/init.d/</li>
<li>$GRADLE_HOME/init.d/</li>
</ul>
<p><strong>Settings Script</strong></p>
<p><code>settings.gradle</code> 用来配置多模块的项目。位于项目根目录下。</p>
<p><strong>Build Script</strong></p>
<p>每个 <code>build.gradle</code> 中包含两种元素：</p>
<ul>
<li>statement：方法调用、属性赋值、局部变量等；</li>
<li>script blocks：脚本块。即一个接受闭包作为参数的方法，该闭包用来配置它的委托对象。</li>
</ul>
<p>脚本在运行期会被编译成一个实现了 <code>Script</code> 接口的类，每个该类的实例都有各自的委托对象：</p>
<ul>
<li>Build Script -&gt; Project</li>
<li>Init Script -&gt; Gradle</li>
<li>Settings Script -&gt; Settings</li>
</ul>
<h2 id="Project"><a href="#Project" class="headerlink" title="Project"></a>Project</h2><p>每个 <code>build.gradle</code> 与一个 <code>Project</code> 对应。构建时 gradle 通过以下方式创建 <code>Project</code> 对象：</p>
<ol>
<li>根据 <code>settings.gradle</code> 创建一个 <code>Settings</code> 对象；</li>
<li>根据 <code>Settings</code> 中定义的工程父子关系创建 <code>Project</code> 对象；</li>
<li>执行每个工程的 <code>build.gradle</code> 对相应的 <code>Project</code> 对象进行配置。</li>
</ol>
<p><code>build.gradle</code> 文件中定义的属性和方法会委托给 <code>Project</code> 执行。</p>
<p>属性范围：</p>
<ol>
<li><code>Project</code>；</li>
<li><code>Project</code> 的 <code>extra</code> 属性？</li>
<li>通过 <code>plugin</code> 添加的 <code>extension</code>，每个 <code>extension</code> 通过一个和 <code>extension</code> 同名的只读属性访问；</li>
<li>通过 <code>plugin</code> 添加的属性。一个 <code>plugin</code> 可以通过 <code>Project</code> 的 <code>Convention</code> 对象为 <code>Project</code> 添加属性和方法；</li>
<li><code>Project</code> 中的 <code>task</code>，一个 <code>task</code> 对象可以通过 <code>Project</code> 中的同名属性访问，但是它是只读的；</li>
<li>当前 <code>Project</code> 的父工程的 <code>extra</code> 属性和 <code>convention</code> 属性；</li>
</ol>
<p>方法范围：</p>
<ol>
<li><code>Project</code> 对象本身；</li>
<li><code>build.gradle</code> 文件中定义的方法；</li>
<li>通过 <code>plugin</code> 添加的 <code>extension</code>，每个 <code>extension</code> 都作为一个接受一个闭包/Action 作为参数的方法被访问；</li>
<li>通过 <code>plugin</code> 添加的方法。一个 <code>plugin</code> 可以通过 <code>Project</code> 的 <code>Convention</code> 对象为 <code>project</code> 添加属性和方法。</li>
<li><code>Project</code> 中的 <code>task</code>。每一个 <code>task</code> 都会在当前 <code>Project</code> 中存在一个接受一个闭包或者/Action 作为参数的方法，这个闭包会在 <code>task</code> 的 <code>configure(closure)</code> 方法中调用。</li>
<li>当前工程的父工程中的方法；</li>
<li>当前工程的属性可见范围中所有的闭包属性都可以作为方法访问</li>
</ol>
<h2 id="Task"><a href="#Task" class="headerlink" title="Task"></a>Task</h2><p><code>Project</code> 中的原子性工作，比如编译、单元测试等。</p>
<h1 id="构建的生命周期"><a href="#构建的生命周期" class="headerlink" title="构建的生命周期"></a>构建的生命周期</h1><ol>
<li>初始化：gradle 决定构建哪些模块，并创建相应的 <code>Project</code> 对象。对于多模块的项目，即使指定了要构建的子模块，也会执行所有在 Settings Script 中的模块的 Build Script。</li>
<li>配置：执行此次构建所包含的所有模块的 Build Script 来配置各个 <code>Project</code> 对象。默认会配置所有 <code>Project</code>。1.4 引入了新特性：<code>--configuration-on-demmand</code>，使用该选项，即使模块被包含在 <code>settings.gradle</code> 中，只要不参与本次构建，那么 <code>Project</code> 会被创建但不会被配置。</li>
<li>执行：gradle 决定执行哪些任务，生成任务依赖图（DAG）。在 Build Script 中出现的任务都会被创建，但如果无需执行的话不会出现在 DAG 里。</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/10/Java/Spring-Cloud/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zeerho">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zeerho">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/10/Java/Spring-Cloud/" itemprop="url">Spring-Cloud</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-10T12:00:00+08:00">2018-08-10</time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Spring-Cloud-和-Spring-Boot-的兼容关系"><a href="#Spring-Cloud-和-Spring-Boot-的兼容关系" class="headerlink" title="Spring Cloud 和 Spring Boot 的兼容关系"></a>Spring Cloud 和 Spring Boot 的兼容关系</h1><table>
<thead>
<tr>
<th style="text-align:left">Spring Cloud</th>
<th style="text-align:left">Spring Boot</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Finchley</td>
<td style="text-align:left">(1.5.x, 2.0.x]</td>
</tr>
<tr>
<td style="text-align:left">Dalston,Edgware</td>
<td style="text-align:left">[1.5.x, 2.0.x)</td>
</tr>
<tr>
<td style="text-align:left">Camden</td>
<td style="text-align:left">[1.4.x, 1.5.x]</td>
</tr>
<tr>
<td style="text-align:left">Brixton</td>
<td style="text-align:left">[1.3.x, 1.4.x]</td>
</tr>
<tr>
<td style="text-align:left">Angel</td>
<td style="text-align:left">1.2.x</td>
</tr>
</tbody>
</table>
<h1 id="actuator"><a href="#actuator" class="headerlink" title="actuator"></a>actuator</h1><h2 id="原生端点"><a href="#原生端点" class="headerlink" title="原生端点"></a>原生端点</h2><p>应用配置类</p>
<ul>
<li><code>/autoconfig</code>：包括所有自动化配置的候选项。同时还有每个候选项是否满足自动化配置的各个先决条件。<ul>
<li><code>positiveMatches</code> 中返回的是条件匹配成功的自动化配置。</li>
<li><code>negativeMatches</code> 中返回的是条件匹配不成功的自动化配置。</li>
</ul>
</li>
<li><code>/beans</code>：用来获取应用上下文中创建的所有 bean。</li>
<li><code>/configprops</code>：用来获取应用中配置的属性信息报告。</li>
<li><code>/env</code>：用来获取应用所有可用的环境属性报告。包括环境变量、JVM 属性、应用的配置属性、命令行中的参数。</li>
<li><code>/mappings</code>：用来返回所有 Spring MVC 的控制器映射关系报告。</li>
<li><code>/info</code>：用来返回一些应用自定义的信息。这些信息要在 <code>application.properties</code> 配置文件中通过 <code>info</code> 前缀来设置。</li>
</ul>
<p>度量指标类</p>
<ul>
<li><code>/metrics</code>：用来返回当前应用的各类重要度量指标，比如内存信息、线程信息、垃圾回收信息等。还可以通过 <code>/metrics/{name}</code> 接口来获取细粒度的信息。</li>
<li><code>/health</code>：spring-boot-starter-actuator 模块中自带了一些健康指标检测器，这些检测器都是 <code>HealthIndicator</code> 接口的实现。<ul>
<li><code>DiskSpaceHealthIndicator</code>：低磁盘空间检测。</li>
<li><code>DataSourceHealthIndicator</code>：检测 DataSource 的连接是否可用。</li>
<li><code>MongoHealthIndicator</code>：检测 Mongo 服务器是否可用。</li>
<li><code>RabbitHealthIndicator</code>：检测 Rabbit 服务器是否可用。</li>
<li><code>RedisHealthIndicator</code>：检测 Redis 服务器是否可用。</li>
<li><code>SolrHealthIndicator</code>：检测 Solr 服务器是否可用。</li>
</ul>
</li>
<li><code>/dump</code>：用来暴露程序运行中的线程信息。它使用 <code>java.lang.management.ThreadMXBean</code> 的 <code>dumpAllThreads</code> 方法来返回所有含有同步信息的活动线程详情。</li>
<li><code>/trace</code>：用来返回基本的 HTTP 跟踪信息。</li>
</ul>
<p>操作控制类</p>
<ul>
<li><code>/shutdown</code>：原生端点只有这个，并且需要配置开启：<code>endpoints.shutdown.enabled=true</code>。</li>
</ul>
<h1 id="服务治理：Spring-Cloud-Eureka"><a href="#服务治理：Spring-Cloud-Eureka" class="headerlink" title="服务治理：Spring Cloud Eureka"></a>服务治理：Spring Cloud Eureka</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>Finchley.SR1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableEurekaServer</span> <span class="comment">// 启动服务注册中心</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">new</span> SpringApplicationBuilder(Application.class).web(<span class="keyword">true</span>).run(args);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>默认设置下，服务注册中心也会把自己作为客户端来注册自己。可以在 <code>application.properties</code> 中禁用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> # 不向注册中心注册自己</span><br><span class="line">eureka.client.register-with-eureka=false</span><br><span class="line"> # 不检索服务</span><br><span class="line">eureka.client.fetch-registry=false</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/07/Groovy/Groovy/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zeerho">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zeerho">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/07/Groovy/Groovy/" itemprop="url">Groovy</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-07T12:00:00+08:00">2018-08-07</time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="maven-引入"><a href="#maven-引入" class="headerlink" title="maven 引入"></a>maven 引入</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.codehaus.groovy<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>groovy-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;groovy.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/08/07/Groovy/Groovy/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/25/Java/ThreadLocal的一些有趣细节/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zeerho">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zeerho">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/25/Java/ThreadLocal的一些有趣细节/" itemprop="url">ThreadLocal的一些有趣细节</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-25T19:15:31+08:00">2018-07-25</time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="设计思路"><a href="#设计思路" class="headerlink" title="设计思路"></a>设计思路</h1><p>ThreadLocal 的设计初看其实是反直觉的。</p>
<p>要设计一种将业务对象与线程绑定的方法，我脑海中蹦出的第一个方案就是在每个 ThreadLocal 实例中维护一个 Map，以 Thread 为键，以业务对象为值。</p>
<p>而实际上 ThreadLocal 的设计思路是：在每个 Thread 实例中维护一个 Map，以 ThreadLocal 为键，以业务对象为值。</p>
<p>两种思路截然相反。实际上重要的不是为什么采用后者，而是为什么不采用前者。</p>
<p>因为前者方案有一个重要缺陷：</p>
<p>既然是将业务对象与线程绑定，那么当线程本身被回收时自然应该取消该线程对所有绑定对象的引用。前者方案要解决这个问题的话无非就是轮询每个线程的状态或者让线程回收时通知自己，显然都不行。后者方案直接将 Map 绑定在线程实例上，从而非常自然地解决了这个问题。</p>
<p>其实后者方案也有一个类似的缺陷：</p>
<p>虽然技术上 ThreadLocal 是一个将业务对象与线程绑定的容器，但这一点对于业务代码来说应该是透明的。换句话说，当业务代码将指向 ThreadLocal 的引用取消后，就应该认为业务代码的实际目的是取消对业务对象的引用。后者方案可以很自然地实现这点，而前者方案则不能。</p>
<p>很显然两种缺陷是对称的。其中的核心是：业务对象的生命周期应该取 Thread 和 ThreadLocal 两者的较短者，而两者的生命周期互相独立，所以必选其一。我猜测最终选择当前这种方案的理由是，TheadLocal 通常是被声明成一个 static 成员来使用的，生命周期贯穿应用的生命周期，比线程更长，所以绑定到线程上。</p>
<p>反例场景是很明显的：线程池中的线程可以是贯穿整个应用生命周期的，而 ThreadLocal 也完全可以被业务代码置 null。ThreadLocal 的设计者为了避免在这类场景下出现内存泄露，一方面在它的多个方法中搜索无效的 ThreadLocal 实例（通过弱引用实现）并清空相应的业务对象引用，另一方面强调业务代码要手动调用 remove 方法。</p>
<h1 id="ThreadLocalMap-的实现"><a href="#ThreadLocalMap-的实现" class="headerlink" title="ThreadLocalMap 的实现"></a>ThreadLocalMap 的实现</h1><p>ThreadLocalMap 是一种散列表，通过线性探查法解决哈希冲突。</p>
<p>线性探查法有两个主要的问题：</p>
<ol>
<li>若散列程度不够，那么局部会有大量元素聚积。</li>
<li>对于哈希冲突的元素会紧挨着依次向后罗列。所以当删除其中某个元素时，要将后面的所有元素前移。</li>
</ol>
<p>解决这两个问题的关键在于要有个优秀的散列算法。</p>
<p>ThreadLocal 产生哈希值的方法是反复对 0x61C88647 进行累加。源码中的注释是：</p>
<blockquote>
<p>turns implicit sequential thread-local IDs into near-optimally spread multiplicative hash values for power-of-two-sized tables</p>
</blockquote>
<p>也就是说 0x61C88647 这个魔数在 2 的次方大小的空间内具有“接近完美”的哈希程度。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/10/Java/Spring-Boot/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zeerho">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zeerho">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/10/Java/Spring-Boot/" itemprop="url">Spring-Boot</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-10T12:00:00+08:00">2018-07-10</time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Spring-Boot-预置的依赖"><a href="#Spring-Boot-预置的依赖" class="headerlink" title="Spring Boot 预置的依赖"></a>Spring Boot 预置的依赖</h1><p>位于 <code>spring-boot-dependencies-{version}.pom</code> 文件中。可在用户项目的 pom 中重写特定依赖的版本。</p>
<h1 id="属性加载顺序"><a href="#属性加载顺序" class="headerlink" title="属性加载顺序"></a>属性加载顺序</h1><p>按以下顺序优先级由高到低。</p>
<ol>
<li>命令行参数。</li>
<li>SPRING_APPLICATION_JSON 中的属性。这是以 JSON 格式配置在系统环境变量中的内容。</li>
<li>java:comp/env 中的 JNDI 属性。</li>
<li>Java 的系统属性，可以通过 <code>System.getProperties()</code> 获得的内容。</li>
<li>操作系统的环境变量。</li>
<li>通过 <code>random.*</code> 配置的随机属性。</li>
<li>位于当前应用 jar 包之外，针对不同 <code>{profile}</code> 环境的配置文件内容。例如 <code>application-{profile}.properties</code> 或是 YAML 定义的配置文件。</li>
<li>位于当前应用 jar 包之内，针对不同 <code>{profile}</code> 环境的配置文件内容。例如 <code>application-{profile}.properties</code> 或是 YAML 定义的配置文件。</li>
<li>位于当前应用 jar 包之外的 <code>application.properties</code> 和 YAML 配置内容。</li>
<li>位于当前应用 jar 包之内的 <code>application.properties</code> 和 YAML 配置内容。</li>
<li>在 <code>@Configuration</code> 注解修改的类中，通过 <code>@PropertySource</code> 注解定义的属性。</li>
<li>应用默认属性，使用 <code>SpringApplication.setDefaultProperties</code> 定义的内容。</li>
</ol>
<h1 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReadingListApplication</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    SpringApplication.run(ReadingListApplication.class, args);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>@SpringBootApplication</code>：整合了 <code>@Configuration</code>、<code>@EnableAutoConfiguration</code>、<code>@Component</code>。</p>
<ul>
<li><code>@EnableAutoConfiguration</code>：允许 Spring 进行智能配置。Spring 会在用户定义的 bean 注册之后，根据当前环境自动注册一些 bean。通过引入的 <code>AutoConfigurationImportSelector</code> 的进行筛选。</li>
<li><code>@Component(excludeFilters = {@Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class), @Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class)})</code>：启用自动扫描，范围是当前类所在的包。会排除一些组件：<ul>
<li>自动扫描用户实现的 <code>TypeExcludeFilter</code> 来排除某些类。</li>
<li>排除一些自动配置类，具体在 <code>META-INF/spring.factories</code> 中的 <code>org.springframework.boot.autoconfigure.EnableAutoConfiguration</code> 中。</li>
</ul>
</li>
</ul>
<h1 id="banner"><a href="#banner" class="headerlink" title="banner"></a>banner</h1><p><code>Banner</code> 接口负责打印 banner。</p>
<p><code>Banner.Mode</code> 有三种模式：OFF 关闭、LOG 日志、CONSOLE 控制台。<br>可以通过 <code>SpringApplication.setBannerMode()</code> 方法来设置。</p>
<p><code>SpringApplication.printBanner()</code> 方法负责根据 Banner 模式来调用 <code>SpringApplicationBannerPrinter</code> 的不同打印方法。</p>
<p><code>SpringApplicationBannerPrinter.getBanner()</code> 方法负责获取 <code>Banner</code> 实现类：</p>
<ol>
<li>根据环境中的配置来加载图片和文本 banner：<ol>
<li><code>Environment.getProperty(BANNER_IMAGE_LOCATION_PROPERTY)</code>、<code>Environment.getProperty(BANNER_LOCATION_PROPERTY, DEFAULT_BANNER_LOCATION)</code>。</li>
<li>若未配置则默认取 resources 目录下的 banner 文件，后缀名包括 txt、gif、jpg、png。</li>
</ol>
</li>
<li>若没加载到，则用 <code>SpringApplication</code> 传入的默认 banner（可能为空）。</li>
</ol>
<h1 id="条件化注解"><a href="#条件化注解" class="headerlink" title="条件化注解"></a>条件化注解</h1><ul>
<li><code>@ConditionalOnBean</code>、<code>@ConditionalOnMissingBean</code>：（没）配置了某个特定的 bean。</li>
<li><code>@ConditionalOnClass</code>、<code>@ConditionalOnMissingClass</code>：Classpath 里（没）有指定的类。</li>
<li><code>@ConditionalOnExpression</code>：给定的 SpEL 结果为 true。</li>
<li><code>@ConditionalOnJava</code>：Java 版本匹配某个特定值或范围。</li>
<li><code>@ConditionalOnJndi</code>：参数中给定的 JNDI 位置必须存在一个，如果没有参数，则要有 JNDI <code>InitialContext</code>。</li>
<li><code>@ConditionalOnProperty</code>：指定的配置属性要有一个明确的值。</li>
<li><code>@ConditionalOnResource</code>：Classpath 里有指定的资源。</li>
<li><code>@ConditionalOnWebApplication</code>、<code>@ConditionalOnNotWebApplication</code>：这（不）是一个 Web 程序。</li>
</ul>
<h1 id="自定义配置"><a href="#自定义配置" class="headerlink" title="自定义配置"></a>自定义配置</h1>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/14/Java/JavaWeb/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zeerho">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zeerho">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/14/Java/JavaWeb/" itemprop="url">JavaWeb</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-14T16:43:00+08:00">2018-05-14</time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="url-pattern"><a href="#url-pattern" class="headerlink" title="url-pattern"></a>url-pattern</h1><p><code>&lt;url-pattern&gt;/*&lt;/url-pattern&gt;</code></p>
<p>匹配所有路径，会覆盖所有其他 servlet 的路径映射，包括 servlet 容器所有内置缺省的 servlet（这些 servlet 一般用来处理静态资源、HTTP 缓存请求、媒体数据流和文件下载）。这种匹配方式一般用在过滤器上。</p>
<p><code>&lt;url-pattern&gt;/&lt;/url-pattern&gt;</code></p>
<p>只覆盖 servlet 容器内置缺省的 servlet，不覆盖其他的任何 servlet。也就是说，要自己实现对静态资源等请求的映射，但这里所说的静态资源不含 jsp 文件，因为 jsp 文件由另一个内置的 servlet 来负责处理。可在主配置中做如下配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">location</span>=<span class="string">"somewhere/js/"</span> <span class="attr">mapping</span>=<span class="string">"/js/**"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">location</span>=<span class="string">"somewhere/css/"</span> <span class="attr">mapping</span>=<span class="string">"/css/**"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">location</span>=<span class="string">"somewhere/images/"</span> <span class="attr">mapping</span>=<span class="string">"/images/**"</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 或者 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>&lt;url-pattern&gt;&lt;/url-pattern&gt;</code></p>
<p>当上下文的根被请求的时候，它将被调用。这跟 <code>&lt;welcome-file&gt;</code> 的方式是不同的，因为这种形式在当任何子目录被请求的时候不会被调用。一般用来处理对于首页的请求。</p>
<h1 id="错误代码跳转"><a href="#错误代码跳转" class="headerlink" title="错误代码跳转"></a>错误代码跳转</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">error-code</span>&gt;</span>404<span class="tag">&lt;/<span class="name">error-code</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">location</span>&gt;</span>/somewhere/404Error.jsp<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">exception-type</span>&gt;</span>com.example.ExampleException<span class="tag">&lt;/<span class="name">exception-type</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">location</span>&gt;</span>/somewhere/Error.jsp<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="load-on-startup"><a href="#load-on-startup" class="headerlink" title="load-on-startup"></a>load-on-startup</h1><ol>
<li><code>load-on-startup</code> 元素标记容器是否应该在 web 应用程序启动的时候就加载这个 servlet，(实例化并调用其 <code>init()</code> 方法)。</li>
<li>它的值必须是一个整数，表示 servlet 被加载的先后顺序。</li>
<li>如果该元素的值为负数或者没有设置，则容器会当 Servlet 被请求时再加载。</li>
<li>如果值为正整数或者 0 时，表示容器在应用启动时就加载并初始化这个 servlet，值越小，优先级越高，就越先被加载。值相同时，容器就会自己选择顺序来加载。</li>
</ol>
<h1 id="HttpServletRequest-getSession"><a href="#HttpServletRequest-getSession" class="headerlink" title="HttpServletRequest#getSession()"></a>HttpServletRequest#getSession()</h1><ul>
<li><code>getSession(true)</code>: 若没有会话则创建。</li>
<li><code>getSession()</code>: 同上。</li>
<li><code>getSession(false)</code>: 若没有会话则返回 null。</li>
</ul>
<h1 id="HttpSession-getId-和-HttpServletRequest-getRequestedSessionId"><a href="#HttpSession-getId-和-HttpServletRequest-getRequestedSessionId" class="headerlink" title="HttpSession#getId() 和 HttpServletRequest#getRequestedSessionId()"></a>HttpSession#getId() 和 HttpServletRequest#getRequestedSessionId()</h1><ul>
<li><code>HttpSession#getId()</code>: web 容器创建会话时创建的 id。</li>
<li><code>HttpServletRequest#getRequestedSessionId()</code>: 浏览器请求的 id，对应 cookie 中的 JSESSIONID 字段（可以在容器中自定义名称）。可能与内部的 id 不同，比如服务端会话过期后新建了而浏览器的 cookie 还没更新，或浏览器的 cookie 被清理了而服务端还没过期（后者情况会认证失败）。</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/27/Java/动态代理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zeerho">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zeerho">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/27/Java/动态代理/" itemprop="url">动态代理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-27T00:48:20+08:00">2018-04-27</time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyTest</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">//动态代理</span></span><br><span class="line">    Class&lt;?&gt;[] interfaces = <span class="keyword">new</span> Class&lt;?&gt;[]&#123;Person.class&#125;;</span><br><span class="line">    Person p = (Person) Proxy.newProxyInstance(</span><br><span class="line">        Person.class.getClassLoader(),</span><br><span class="line">        interfaces,</span><br><span class="line">        <span class="keyword">new</span> ProxyPerson(<span class="keyword">new</span> Man()));</span><br><span class="line">    p.walk();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查看动态生成的代理类</span></span><br><span class="line">    <span class="keyword">byte</span>[] classbytes = ProxyGenerator.generateProxyClass(<span class="string">"MyProxy"</span>, interfaces);</span><br><span class="line">    FileOutputStream os = <span class="keyword">new</span> FileOutputStream(<span class="string">"D:/MyProxy.class"</span>);</span><br><span class="line">    os.write(classbytes);</span><br><span class="line">    os.flush();</span><br><span class="line">    os.close();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">walk</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Man</span> <span class="keyword">implements</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">walk</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"in Man..."</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProxyPerson</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> Person person;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ProxyPerson</span><span class="params">(Person person)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.person = person;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"in ProxyPerson before..."</span>);</span><br><span class="line">    Object rtn = method.invoke(person, args);</span><br><span class="line">    System.out.println(<span class="string">"in ProxyPerson after..."</span>);</span><br><span class="line">    <span class="keyword">return</span> rtn;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by Fernflower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.UndeclaredThrowableException;</span><br><span class="line"><span class="keyword">import</span> me.zephyr.proxy.Person;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">MyProxy</span> <span class="keyword">extends</span> <span class="title">Proxy</span> <span class="keyword">implements</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> Method m1;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> Method m3;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> Method m2;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> Method m0;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">MyProxy</span><span class="params">(InvocationHandler var1)</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(var1);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object var1)</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> ((Boolean)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m1, <span class="keyword">new</span> Object[]&#123;var1&#125;)).booleanValue();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RuntimeException | Error var3) &#123;</span><br><span class="line">      <span class="keyword">throw</span> var3;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable var4) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var4);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">walk</span><span class="params">()</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m3, (Object[])<span class="keyword">null</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">      <span class="keyword">throw</span> var2;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var3);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> String <span class="title">toString</span><span class="params">()</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> (String)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m2, (Object[])<span class="keyword">null</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">      <span class="keyword">throw</span> var2;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var3);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> ((Integer)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m0, (Object[])<span class="keyword">null</span>)).intValue();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">      <span class="keyword">throw</span> var2;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var3);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      m1 = Class.forName(<span class="string">"java.lang.Object"</span>).getMethod(<span class="string">"equals"</span>, Class.forName(<span class="string">"java.lang.Object"</span>));</span><br><span class="line">      m3 = Class.forName(<span class="string">"me.zephyr.proxy.Person"</span>).getMethod(<span class="string">"walk"</span>);</span><br><span class="line">      m2 = Class.forName(<span class="string">"java.lang.Object"</span>).getMethod(<span class="string">"toString"</span>);</span><br><span class="line">      m0 = Class.forName(<span class="string">"java.lang.Object"</span>).getMethod(<span class="string">"hashCode"</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchMethodException var2) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchMethodError(var2.getMessage());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ClassNotFoundException var3) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> NoClassDefFoundError(var3.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">zeerho</p>
              <p class="site-description motion-element" itemprop="description">Just a repo for documents</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">67</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">22</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/ZephyrHuang" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:zephyrhuang21@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zeerho</span>

  

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Gemini</a> v6.0.0</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.0.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.0.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.0.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.0.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.0.0"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
